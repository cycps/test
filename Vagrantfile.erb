# -*- mode: ruby -*-
# vi: set ft=ruby :
    
#hostnamectl set-hostname cydata

Vagrant.configure(2) do |config|

  config.vm.box = "boxcutter/ubuntu1504"

  config.vm.define "data" do |data|
    data.vm.network "public_network", ip: "192.168.1.201"
    data.vm.hostname = "cydata0"
    data.vm.synced_folder "<%= @cydata %>/sql", "/home/vagrant/.cypress/data/sql"

    data.vm.provision "shell", privileged: false, inline: <<-SHELL
      sudo chown -R vagrant:vagrant $HOME/.cypress
    SHELL

    data.vm.provision :file, 
      source: '../data_provision.sh', 
      destination: '/home/vagrant/.cypress/provision.sh'

    data.vm.provision "shell", privileged: false, inline: <<-SHELL
      $HOME/.cypress/provision.sh
    SHELL
  end

  config.vm.define "svc" do |svc|
    svc.vm.network "public_network", ip: "192.168.1.202"
    svc.vm.hostname = "addie"
    svc.vm.synced_folder "<%= @cyaddie %>", "/home/vagrant/go/src/github.com/cycps/addie"

    svc.vm.provision :file, 
      source: '../svc_provision.sh', 
      destination: '/home/vagrant/.cypress/provision.sh'

    svc.vm.provision "shell", privileged: false, inline: <<-SHELL
      $HOME/.cypress/provision.sh
    SHELL
  end

  config.vm.define "client" do |cli|
    cli.vm.network "public_network", ip: "192.168.1.203"
    cli.vm.hostname = "client"
    cli.vm.synced_folder "<%= @cyaddie %>/spec", "/home/vagrant/apitest"

    cli.vm.provision "shell", privileged: false, inline: <<-SHELL
      sudo chown -R vagrant:vagrant $HOME/.cypress
    SHELL

    config.vm.provision :file, 
      source: '../client_provision.sh', 
      destination: '/home/vagrant/.cypress/provision.sh'
      
    config.vm.provision :file, 
      source: '../run_dredd_api_tests.sh', 
      destination: '/home/vagrant/apitest/run_dredd_api_tests.sh'
      
      config.vm.provision :file, 
      source: '../hookstls.js', 
      destination: '/home/vagrant/apitest/hookstls.js'

    cli.vm.provision "shell", privileged: false, inline: <<-SHELL
      $HOME/.cypress/provision.sh
    SHELL
  end

    
  

end
